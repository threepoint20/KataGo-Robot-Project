# 圍棋機械人專案進度總結 (2025年7月30日 晚間)

## 討論目標

* 解決 Python/OpenCV 讀取 iPhone 鏡頭影像串流的問題。
* 實現基礎影像處理：灰度轉換、邊緣檢測。
* 討論使用 2D 相機控制機械手臂 Z 軸（高度）的策略。

## 階段性成果與解決方案

### 1. iPhone 鏡頭影像串流導入 OpenCV

* **初始問題**：
    * `pip` 命令未找到（已解決：需在虛擬環境中運行）。
    * Python 程式使用 `cv2.VideoCapture(0)` 運行後無任何輸出或視窗彈出，或只能打開內建攝影機。
    * Camo Studio 應用本身顯示 iPhone 畫面正常，但在其他應用程式（如 Google Meet、Photo Booth）中，Camo 虛擬攝影機顯示驚嘆號或無法選用。
    * OpenCV 偵測時顯示 `OpenCV: out device of bound (0-0): 1`，表示它認為只有索引 0 的攝影機存在。

* **偵錯過程**：
    1.  **確認 `pip` 環境**：指導用戶回到虛擬環境 `(.venv)` 後，成功安裝 `opencv-python`。
    2.  **程式碼調整**：逐步完善 `open_cv.py`，增加詳細的日誌輸出，用於偵測攝影機索引和後端資訊。
    3.  **Camo 驅動排查**：強調問題不在 Python 程式碼，而在於 Camo 虛擬攝影機驅動在 macOS 系統中未被正確識別。指導用戶重啟 Camo Studio、重裝驅動、重啟 Mac，並在其他應用中驗證 Camo Camera 的可用性。
    4.  **關鍵突破**：用戶最終確認**沒有內建攝影機**，且 **`cv2.VideoCapture(0)` 能夠直接開啟 Camo Camera**（iPhone 鏡頭）。

* **解決方案**：
    * 直接使用 `cv2.VideoCapture(0)`，因為在沒有內建攝影機的系統上，Camo Camera 成功地將自己註冊為 OpenCV 可用的第一個（也是唯一一個）裝置。
    * **結果**：成功獲得 iPhone 鏡頭的即時影像串流。

### 2. 基礎影像處理：灰度轉換、邊緣檢測

* **功能實現**：
    * **灰度轉換**：使用 `cv2.cvtColor(frame, cv2.COLOR_BGR2GRAY)` 將彩色影像轉換為單通道灰度影像，以簡化後續處理。
    * **高斯模糊 (Gaussian Blur)**：使用 `cv2.GaussianBlur()` 平滑灰度影像，去除噪音。
    * **Canny 邊緣檢測**：使用 `cv2.Canny()` 從模糊後的影像中提取邊緣，用於清晰地顯示棋盤線條。

* **霍夫變換 (Hough Transform) 偵測直線**：
    * **目標**：從 Canny 檢測到的邊緣中識別出直線。
    * **實現**：使用 `cv2.HoughLinesP()` 進行概率霍夫變換，參數（`threshold`, `minLineLength`, `maxLineGap`）需要根據實際影像進行調優。
    * **結果**：初步成功偵測並繪製出影像中的線段，包括棋盤線條。

## 明日繼續：圍棋盤線條的進一步處理

* 基於霍夫變換偵測到的線條，明天我們將繼續：
    * **過濾和分類線條**：區分水平線和垂直線，並根據間距和角度過濾非棋盤線條。
    * **識別棋盤網格**：從正確的線條中建立圍棋盤的網格結構。
    * **透視校正**：將棋盤影像校正為標準的俯視視角。

## 機械手臂 Z 軸（高度）控制討論

* **問題**：如何在僅有 2D 影像的情況下，精確控制機械手臂的落子高度（Z 軸）。
* **結論**：對於圍棋應用，**2D 相機是可行且常用的選擇**。
* **解決策略**：
    1.  **精確機械校準**：在初期對機械手臂、棋盤和棋子容器進行一次性、高度精確的物理校準。記錄棋盤表面高度、棋子吸取高度、棋子放置高度等固定 Z 座標值。
    2.  **程式碼中預定義高度**：將這些校準後的 Z 座標作為常數整合到 Python 程式碼中。
    3.  **仔細的動作規劃**：機械手臂在移動到吸取點或放置點時，先移動到一個安全高度，再精確降低到預定義的 Z 軸高度執行動作。
* **LiDAR 討論**：LiDAR 能提供直接的 3D 深度資訊，但在圍棋機械人應用中，其成本、複雜性和缺乏顏色資訊的劣勢，通常會使其不如 2D 相機+精確校準更具實用性。除非有特殊需求（如極端光線環境），否則不推薦。

---

明天我們將會繼續在已偵測到的線條基礎上，進行棋盤網格的精確辨識和透視校正。

祝您晚安，明天繼續！